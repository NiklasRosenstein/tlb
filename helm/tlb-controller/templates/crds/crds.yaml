---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: tunnelclasses.tlb.io
spec:
  group: tlb.io
  names:
    categories: []
    kind: TunnelClass
    plural: tunnelclasses
    shortNames: []
    singular: tunnelclass
  scope: Namespaced
  versions:
  - additionalPrinterColumns: []
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for TunnelClassSpec via `CustomResource`
        properties:
          spec:
            description: Define a namespaced tunnel class.
            properties:
              cloudflare:
                description: Configuration for creating Cloudflare tunnels.
                nullable: true
                properties:
                  accountId:
                    description: Cloudflare account ID. Required for API mode, ignored for Quick mode.
                    nullable: true
                    type: string
                  announceType:
                    description: How to announce the tunnel DNS name in the Service's `loadBalancerStatus`. Defaults to [`CloudflareAnnounceType::External`].
                    enum:
                    - Internal
                    - External
                    nullable: true
                    type: string
                  apiTokenRef:
                    description: Reference to secret containing Cloudflare API token. Required for API mode, ignored for Quick mode.
                    nullable: true
                    properties:
                      key:
                        type: string
                      name:
                        type: string
                      namespace:
                        nullable: true
                        type: string
                    required:
                    - key
                    - name
                    type: object
                  enableUdpBufferTuning:
                    description: Enable UDP buffer tuning by setting net.core.rmem_max and net.core.wmem_max sysctls. This resolves the "failed to sufficiently increase receive buffer size" error from cloudflared. Requires the cluster to allow these sysctls. Defaults to `false` for security reasons.
                    nullable: true
                    type: boolean
                  image:
                    description: The cloudflared image to use for the tunnel pods. Defaults to `cloudflare/cloudflared:latest`.
                    nullable: true
                    type: string
                  resourcePrefix:
                    description: Prefix for the resources that are created for the Netbird tunnel. Defaults to `cf-`.
                    nullable: true
                    type: string
                  tunnelPrefix:
                    description: Prefix for the name of the Cloudflare tunnel. Defaults to `kube-`. Only used in API mode.
                    nullable: true
                    type: string
                type: object
              netbird:
                description: |-
                  Configuration for creating Netbird tunnels.

                  Important: The special port [`crate::netbird::NETBIRD_PEER_IP_PORT`] is used to expose the Netbird peer IP in the pod and can therefore not be used by the service that is exposed by the tunnel.
                nullable: true
                properties:
                  announceType:
                    description: How to register the Netbird tunnel in the Service's `loadBalancerStatus`. Defaults to [`NetbirdAnnounceType::IP`].
                    enum:
                    - IP
                    - DNS
                    nullable: true
                    type: string
                  clusterInterface:
                    description: The cluster interface that handles outgoing traffic into the target service. Defaults to `eth0`.
                    nullable: true
                    type: string
                  enableEbpfCapabilities:
                    description: Enable eBPF capabilities (SYS_ADMIN and SYS_RESOURCE) for the NetBird container. When enabled, prevents fallback to user space proxy. Defaults to `true`.
                    nullable: true
                    type: boolean
                  image:
                    description: The netbird image to use for the tunnel pods. Defaults to `netbirdio/netbird:latest`. Note that the image must have `nc` installed that is BusyBox compatible, as it is used to export the Netbird peer IP to the controller.
                    nullable: true
                    type: string
                  managementUrl:
                    type: string
                  netbirdDnsDomain:
                    description: The domain used for Netbird DNS, usually `netbird.selfhosted` or `netbird.cloud`. This is used so we can know the full domain name when using the `tlb.io/dns` annotation. If the name specified in the annotation is suffixed with this domain, it will be stripped as Netbird will automatically append it.
                    nullable: true
                    type: string
                  netbirdInterface:
                    description: The netbird interface that is created by running `netbird up` in the container. Defaults to `wt0`.
                    nullable: true
                    type: string
                  resourcePrefix:
                    description: Prefix for the resources that are created for the Netbird tunnel. Defaults to `tunnel-`.
                    nullable: true
                    type: string
                  setupKeyRef:
                    description: Reference to a secret key. May be namespaced if used in a [`ClusterTunnelClassSpec`], otherwise the namespace is ignored and the [`TunnelClassSpec`]'s namespace is used.
                    properties:
                      key:
                        type: string
                      name:
                        type: string
                      namespace:
                        nullable: true
                        type: string
                    required:
                    - key
                    - name
                    type: object
                  size:
                    description: The size of the persistent volume claim. Defaults to `32Mi`. Note that some storage classes have a minimum size, so you might need to adjust this value.
                    nullable: true
                    type: string
                  storageClass:
                    description: The storage class to use for the persistent volume claim. If this is not set, an emptyDir will be used.
                    nullable: true
                    type: string
                  upCommand:
                    description: The command to run alias to `netbird up` in the container. Defaults to [`crate::netbird::DEFAULT_NETBIRD_UP_COMMAND`].
                    nullable: true
                    type: string
                required:
                - managementUrl
                - setupKeyRef
                type: object
            type: object
        required:
        - spec
        title: TunnelClass
        type: object
    served: true
    storage: true
    subresources: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: clustertunnelclasses.tlb.io
spec:
  group: tlb.io
  names:
    categories: []
    kind: ClusterTunnelClass
    plural: clustertunnelclasses
    shortNames: []
    singular: clustertunnelclass
  scope: Cluster
  versions:
  - additionalPrinterColumns: []
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for ClusterTunnelClassSpec via `CustomResource`
        properties:
          spec:
            description: Define a cluster-scoped tunnel class.
            properties:
              cloudflare:
                description: Configuration for creating Cloudflare tunnels.
                nullable: true
                properties:
                  accountId:
                    description: Cloudflare account ID. Required for API mode, ignored for Quick mode.
                    nullable: true
                    type: string
                  announceType:
                    description: How to announce the tunnel DNS name in the Service's `loadBalancerStatus`. Defaults to [`CloudflareAnnounceType::External`].
                    enum:
                    - Internal
                    - External
                    nullable: true
                    type: string
                  apiTokenRef:
                    description: Reference to secret containing Cloudflare API token. Required for API mode, ignored for Quick mode.
                    nullable: true
                    properties:
                      key:
                        type: string
                      name:
                        type: string
                      namespace:
                        nullable: true
                        type: string
                    required:
                    - key
                    - name
                    type: object
                  enableUdpBufferTuning:
                    description: Enable UDP buffer tuning by setting net.core.rmem_max and net.core.wmem_max sysctls. This resolves the "failed to sufficiently increase receive buffer size" error from cloudflared. Requires the cluster to allow these sysctls. Defaults to `false` for security reasons.
                    nullable: true
                    type: boolean
                  image:
                    description: The cloudflared image to use for the tunnel pods. Defaults to `cloudflare/cloudflared:latest`.
                    nullable: true
                    type: string
                  resourcePrefix:
                    description: Prefix for the resources that are created for the Netbird tunnel. Defaults to `cf-`.
                    nullable: true
                    type: string
                  tunnelPrefix:
                    description: Prefix for the name of the Cloudflare tunnel. Defaults to `kube-`. Only used in API mode.
                    nullable: true
                    type: string
                type: object
              netbird:
                description: |-
                  Configuration for creating Netbird tunnels.

                  Important: The special port [`crate::netbird::NETBIRD_PEER_IP_PORT`] is used to expose the Netbird peer IP in the pod and can therefore not be used by the service that is exposed by the tunnel.
                nullable: true
                properties:
                  announceType:
                    description: How to register the Netbird tunnel in the Service's `loadBalancerStatus`. Defaults to [`NetbirdAnnounceType::IP`].
                    enum:
                    - IP
                    - DNS
                    nullable: true
                    type: string
                  clusterInterface:
                    description: The cluster interface that handles outgoing traffic into the target service. Defaults to `eth0`.
                    nullable: true
                    type: string
                  enableEbpfCapabilities:
                    description: Enable eBPF capabilities (SYS_ADMIN and SYS_RESOURCE) for the NetBird container. When enabled, prevents fallback to user space proxy. Defaults to `true`.
                    nullable: true
                    type: boolean
                  image:
                    description: The netbird image to use for the tunnel pods. Defaults to `netbirdio/netbird:latest`. Note that the image must have `nc` installed that is BusyBox compatible, as it is used to export the Netbird peer IP to the controller.
                    nullable: true
                    type: string
                  managementUrl:
                    type: string
                  netbirdDnsDomain:
                    description: The domain used for Netbird DNS, usually `netbird.selfhosted` or `netbird.cloud`. This is used so we can know the full domain name when using the `tlb.io/dns` annotation. If the name specified in the annotation is suffixed with this domain, it will be stripped as Netbird will automatically append it.
                    nullable: true
                    type: string
                  netbirdInterface:
                    description: The netbird interface that is created by running `netbird up` in the container. Defaults to `wt0`.
                    nullable: true
                    type: string
                  resourcePrefix:
                    description: Prefix for the resources that are created for the Netbird tunnel. Defaults to `tunnel-`.
                    nullable: true
                    type: string
                  setupKeyRef:
                    description: Reference to a secret key. May be namespaced if used in a [`ClusterTunnelClassSpec`], otherwise the namespace is ignored and the [`TunnelClassSpec`]'s namespace is used.
                    properties:
                      key:
                        type: string
                      name:
                        type: string
                      namespace:
                        nullable: true
                        type: string
                    required:
                    - key
                    - name
                    type: object
                  size:
                    description: The size of the persistent volume claim. Defaults to `32Mi`. Note that some storage classes have a minimum size, so you might need to adjust this value.
                    nullable: true
                    type: string
                  storageClass:
                    description: The storage class to use for the persistent volume claim. If this is not set, an emptyDir will be used.
                    nullable: true
                    type: string
                  upCommand:
                    description: The command to run alias to `netbird up` in the container. Defaults to [`crate::netbird::DEFAULT_NETBIRD_UP_COMMAND`].
                    nullable: true
                    type: string
                required:
                - managementUrl
                - setupKeyRef
                type: object
            type: object
        required:
        - spec
        title: ClusterTunnelClass
        type: object
    served: true
    storage: true
    subresources: {}
